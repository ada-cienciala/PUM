<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <canvas id="canvas" width="800" height="600" style="border:1px solid #000000;"></canvas>
</body>
<script>

var canvas = {width:800, height:600 };
var score = 0;

var c = document.getElementById("canvas");
var ctx = c.getContext("2d");

var player = {
	x:canvas.width/2,
	y:canvas.height-100,
	speed: 20,
    shoot: function () {
        console.log("Shot!")
        missiles.push({
            x: player.x,
            y: player.y,
            speed: 10
        })
    }
};

var missiles = []
var enemies = []

////// Arrow keys //////

function move(e) {
	
	if(e.keyCode == 37) { 
		player.x -= player.speed;
	}
	if(e.keyCode == 39) {
		player.x += player.speed;	
	}
    if(e.keyCode == 32) {
		player.shoot()	
	}
	
	update();
	
}

document.onkeydown = move;

////// other functions //////


//function to clear canvas
function clearCanvas() {
	ctx.clearRect(0,0,canvas.width,canvas.height);
}

// Draw Player ship.
function ship() {
	var x = player.x;
	var y = player.y;
	ctx.fillStyle = "black";

	ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.rect(x, y, 20, 35)
    ctx.fill();
}

// Draw missile.
function moveMissiles(missile) {
    var x = missile.x;
	var y = missile.y;
	ctx.fillStyle = "red";

	ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.arc(x, y, 5, 0, 2 * Math.PI);
    ctx.fill();

    checkIfShot(x, y)
}

// Draw enemy.
function moveEnemy(enemy) {
    var x = enemy.x;
	var y = enemy.y;
	ctx.fillStyle = "green";

	ctx.beginPath();
    ctx.moveTo(x,y);
    ctx.arc(x, y, e.radius, 0, 2 * Math.PI);
    ctx.fill();
}

function checkIfShot(x, y) {
    let tokill = -1
    for (let i = 0; i < enemies.length; ++i) {
        let e = enemies[i]
        if ((x >= e.x - e.radius && x <= e.x + e.radius) && (y >= e.y - e.radius && y <= e.y + e.radius)) {
            console.log("HIT")
            tokill = i
            score += 1;
            break
        }
    }
    if (tokill != -1) enemies.splice(tokill, 1)
}

// update

setInterval (update, 50);
setInterval (spawnEnemy, 2000);

function spawnEnemy() {
    enemy = {
        x: Math.floor(Math.random() * (canvas.width-20 - 20 + 1)) + 20,
        y: 0,
        speed: 2,
        radius: 20
    }
    enemies.push(enemy)
}

function showScore() {
    
}

function update() {
	clearCanvas();
	ship();
    for (m of missiles) {
        m.y -= m.speed;
        moveMissiles(m)
    }
    for (e of enemies) {
        e.y += e.speed;
        moveEnemy(e)
    }
    showScore()
}
    
</script>
</html>